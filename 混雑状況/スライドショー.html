<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>文化祭サイネージ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        body { margin: 0; background: #000; color: white; overflow: hidden; font-family: "Meiryo", sans-serif; }
        .swiper { width: 100vw; height: 100vh; }
        .slide-content {
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; height: 100%; text-align: center;
        }
        .status-badge {
            font-size: 4rem; padding: 20px 60px; border-radius: 100px;
            font-weight: bold; margin-bottom: 40px; text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }
        .status-空き { background: #28a745; }
        .status-混雑 { background: #ffc107; color: black; }
        .status-売り切れ・終了 { background: #dc3545; }
        
        .project-name { font-size: 6rem; font-weight: bold; margin: 20px 0; }
        .group-name { font-size: 3rem; color: #ccc; }
        .location { font-size: 3.5rem; margin-top: 30px; color: #1a73e8; background: white; padding: 10px 40px; border-radius: 20px; }
    </style>
</head>
<body>
    <div class="swiper">
        <div class="swiper-wrapper" id="slide-container">
            <div class="swiper-slide"><div class="slide-content">Loading...</div></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwGPser_Y53kvBUxZKRRBDhciy9Xk6yVUALsAYxjrgn3ktOhrlfUMI-zUJ4GePwQAvW/exec";
let swiperInstance = null; // Swiperのインスタンスを保持する変数

async function updateData() {
    try {
        const res = await fetch(GAS_URL);
        const data = await res.json();
        const container = document.getElementById('slide-container');
        
        // 1. もし既にSwiperが動いていたら破棄する
        if (swiperInstance !== null) {
            swiperInstance.destroy(true, true);
        }

        // 2. HTMLの中身を空にしてから新しいデータを追加する
        container.innerHTML = data.map(p => `
            <div class="swiper-slide">
                <div class="slide-content">
                    <div style="font-size: 4rem; color: #fff; background: #1a73e8; padding: 10px 50px; border-radius: 15px; margin-bottom: 20px;">
                        ${p['使用教室名']}
                    </div>
                    <div class="project-name">${p['企画名']}</div>
                    <div class="group-name">${p['団体名']}</div>
                    <div class="status-badge status-${p['状況']}" style="margin-top:40px;">
                        ${p['状況']}
                    </div>
                </div>
            </div>
        `).join('');

        // 3. 新しくSwiperを初期化し、変数に保存する
        swiperInstance = new Swiper('.swiper', {
            loop: true,
            autoplay: { 
                delay: 5000,
                disableOnInteraction: false // ユーザーが操作しても自動再生を止めない
            },
            effect: 'fade',
            fadeEffect: {
                crossFade: true // 重なりを防ぎ、綺麗に入れ替える
            }
        });

    } catch (e) { 
        console.error("データ更新エラー:", e); 
    }
}

// 初回実行
updateData();

// 5分ごとに更新
setInterval(updateData, 300000);
    </script>
</body>
</html>